<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>SheetBrain AI - Quick Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-card h2 {
        color: #667eea;
        margin-top: 0;
      }
      .test-result {
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }
      .pass {
        background: #d1fae5;
        color: #065f46;
      }
      .fail {
        background: #fee2e2;
        color: #991b1b;
      }
      code {
        background: #f3f4f6;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
      }
      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #5568d3;
      }
    </style>
  </head>
  <body>
    <h1>üß† SheetBrain AI - Deployment Test</h1>

    <div class="test-card">
      <h2>‚úÖ Pre-Deployment Checklist</h2>
      <ol>
        <li>Backend is live at <code>https://sheetbrain-ai.vercel.app</code></li>
        <li>All environment variables configured in Vercel</li>
        <li>Database schema deployed to Supabase (9 tables)</li>
        <li>Apps Script code copied to Code.gs</li>
        <li>Permissions granted (run onOpen function)</li>
      </ol>
    </div>

    <div class="test-card">
      <h2>üîß Test 1: Backend Health</h2>
      <button onclick="testHealth()">Test Backend</button>
      <div id="healthResult"></div>
    </div>

    <div class="test-card">
      <h2>üîê Test 2: Authentication</h2>
      <button onclick="testAuth()">Test Auth</button>
      <div id="authResult"></div>
    </div>

    <div class="test-card">
      <h2>üìã Google Apps Script Deployment Steps</h2>
      <ol>
        <li><strong>Open Google Sheets</strong> ‚Üí Create or open a spreadsheet</li>
        <li><strong>Extensions ‚Üí Apps Script</strong></li>
        <li><strong>Delete</strong> all existing code in Code.gs</li>
        <li><strong>Copy</strong> entire <code>apps-script-standalone-enhanced.js</code></li>
        <li><strong>Paste</strong> into Code.gs</li>
        <li><strong>Save</strong> (Ctrl+S)</li>
        <li><strong>Run</strong> ‚Üí Select <code>onOpen</code> function</li>
        <li><strong>Review permissions</strong> ‚Üí Allow all</li>
        <li><strong>Refresh</strong> your Google Sheet (F5)</li>
        <li><strong>Test</strong> ‚Üí SheetBrain AI menu should appear</li>
      </ol>
    </div>

    <div class="test-card">
      <h2>üêõ Console Errors - What They Mean</h2>
      <table style="width: 100%; border-collapse: collapse">
        <thead>
          <tr style="background: #f3f4f6">
            <th style="padding: 8px; text-align: left">Error</th>
            <th style="padding: 8px; text-align: left">Meaning</th>
            <th style="padding: 8px; text-align: left">Solution</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid #e5e7eb">
            <td style="padding: 8px"><code>ERR_BLOCKED_BY_CLIENT</code></td>
            <td style="padding: 8px">Ad blocker blocking resources</td>
            <td style="padding: 8px">‚úÖ Ignore (not your app)</td>
          </tr>
          <tr style="border-bottom: 1px solid #e5e7eb">
            <td style="padding: 8px"><code>Unexpected identifier 'Suggestion'</code></td>
            <td style="padding: 8px">Syntax error in button onclick</td>
            <td style="padding: 8px">‚úÖ FIXED in new code</td>
          </tr>
          <tr style="border-bottom: 1px solid #e5e7eb">
            <td style="padding: 8px"><code>Unrecognized feature</code></td>
            <td style="padding: 8px">Browser feature warnings</td>
            <td style="padding: 8px">‚úÖ Ignore (Google Sheets warnings)</td>
          </tr>
          <tr>
            <td style="padding: 8px"><code>404 wardeninit</code></td>
            <td style="padding: 8px">Google internal resource</td>
            <td style="padding: 8px">‚úÖ Ignore (not your app)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="test-card">
      <h2>üéØ Expected Console Output (Good)</h2>
      <pre style="background: #f3f4f6; padding: 15px; border-radius: 4px; overflow-x: auto">
SheetBrain AI script loaded
Window loaded, initializing...
Loading plan info...
Audit button listener attached
Upload button listener attached
All event listeners attached
Plan info received: {success: true, plan: "free", usage: 0, limit: 10}
        </pre
      >
    </div>

    <script>
      async function testHealth() {
        const resultDiv = document.getElementById('healthResult');
        resultDiv.innerHTML = '<p>Testing...</p>';

        try {
          const response = await fetch('https://sheetbrain-ai.vercel.app/api/health');
          const data = await response.json();

          if (response.ok && data.status === 'ok') {
            resultDiv.innerHTML =
              '<div class="test-result pass">‚úÖ Backend is LIVE!<br>' +
              'Status: ' +
              data.status +
              '<br>' +
              'Timestamp: ' +
              data.timestamp +
              '</div>';
          } else {
            resultDiv.innerHTML =
              '<div class="test-result fail">‚ùå Backend returned unexpected response</div>';
          }
        } catch (error) {
          resultDiv.innerHTML =
            '<div class="test-result fail">‚ùå Failed to connect: ' + error.message + '</div>';
        }
      }

      async function testAuth() {
        const resultDiv = document.getElementById('authResult');
        resultDiv.innerHTML = '<p>Testing authentication...</p>';

        try {
          const response = await fetch('https://sheetbrain-ai.vercel.app/api/auth/debug-login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              userId: 'test-user',
              email: 'test@example.com',
              orgId: 'test-org',
              role: 'editor',
            }),
          });

          const data = await response.json();

          if (response.ok && data.accessToken) {
            resultDiv.innerHTML =
              '<div class="test-result pass">‚úÖ Authentication working!<br>' +
              'Token received: ' +
              data.accessToken.substring(0, 30) +
              '...</div>';
          } else {
            resultDiv.innerHTML =
              '<div class="test-result fail">‚ùå Auth failed: ' + JSON.stringify(data) + '</div>';
          }
        } catch (error) {
          resultDiv.innerHTML =
            '<div class="test-result fail">‚ùå Failed to authenticate: ' + error.message + '</div>';
        }
      }
    </script>
  </body>
</html>
